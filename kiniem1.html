<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>12A15 Memories - N∆°i L∆∞u Gi·ªØ K·ª∑ Ni·ªám</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&family=Dancing+Script:wght@400;600;700&family=Caveat:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --beige: #F5F5DC;
            --amber: #92400e;
            --teal: #0d9488;
            --tape-yellow: rgba(255, 220, 100, 0.7);
            --tape-clear: rgba(200, 230, 255, 0.5);
            --tape-plaid: repeating-linear-gradient(45deg, rgba(255,100,100,0.3) 0px, rgba(255,100,100,0.3) 4px, rgba(255,255,255,0.3) 4px, rgba(255,255,255,0.3) 8px);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: var(--beige);
            background-image:
                url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='400' height='400' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
            overflow-x: hidden;
        }

        /* ======= DOODLE BACKGROUND ======= */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
            background-image:
                url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='800' opacity='0.04'%3E%3Ctext x='50' y='80' font-size='40' fill='%23926540'%3E‚úø%3C/text%3E%3Ctext x='300' y='200' font-size='30' fill='%23926540'%3E‚úà%3C/text%3E%3Ctext x='600' y='150' font-size='35' fill='%23926540'%3E‚ô°%3C/text%3E%3Ctext x='100' y='400' font-size='25' fill='%23926540'%3E‚òÖ%3C/text%3E%3Ctext x='500' y='500' font-size='40' fill='%23926540'%3E‚úø%3C/text%3E%3Ctext x='700' y='600' font-size='30' fill='%23926540'%3E‚ô°%3C/text%3E%3Ctext x='200' y='700' font-size='35' fill='%23926540'%3E‚úà%3C/text%3E%3Ctext x='650' y='350' font-size='28' fill='%23926540'%3E‚òÖ%3C/text%3E%3C/svg%3E");
        }

        /* ======= NAVBAR ======= */
        nav {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(245, 245, 220, 0.82);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 2px solid rgba(180, 150, 90, 0.3);
            box-shadow: 0 2px 20px rgba(146, 100, 64, 0.15);
        }
        .nav-inner {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 56px;
            position: relative;
        }
        .nav-logo {
            font-family: 'Dancing Script', cursive;
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--amber);
            text-decoration: none;
            letter-spacing: 1px;
            z-index: 2;
            display: flex;
            align-items: center;
            line-height: 1;
        }
        .nav-logo span {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: var(--amber);
            color: var(--beige);
            border-radius: 50%;
            width: 36px;
            height: 36px;
            font-size: 1rem;
            margin-right: 8px;
            flex-shrink: 0;
        }

        /* ---- Hamburger button ---- */
        .hamburger {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
            width: 40px;
            height: 40px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 10px;
            transition: background 0.2s;
            z-index: 2;
            flex-shrink: 0;
        }
        .hamburger:hover { background: rgba(146,100,64,0.1); }
        .hamburger .bar {
            display: block;
            width: 100%;
            height: 3px;
            background: var(--amber);
            border-radius: 3px;
            transition: transform 0.35s cubic-bezier(.4,0,.2,1), opacity 0.25s, width 0.3s;
            transform-origin: center;
        }
        .hamburger.open .bar:nth-child(1) { transform: translateY(8px) rotate(45deg); }
        .hamburger.open .bar:nth-child(2) { opacity: 0; width: 0; }
        .hamburger.open .bar:nth-child(3) { transform: translateY(-8px) rotate(-45deg); }

        /* ---- Dropdown panel ‚Äî full width overlay ---- */
        .nav-dropdown {
            position: fixed;
            top: 56px;
            left: 0;
            right: 0;
            width: 100%;
            background: rgba(253, 250, 240, 0.98);
            backdrop-filter: blur(18px);
            -webkit-backdrop-filter: blur(18px);
            border-bottom: 2px solid rgba(180,150,90,0.25);
            box-shadow: 0 8px 32px rgba(146,100,64,0.13);
            list-style: none;
            overflow: hidden;
            max-height: 0;
            opacity: 0;
            pointer-events: none;
            transition: max-height 0.35s cubic-bezier(.4,0,.2,1), opacity 0.25s ease;
            z-index: 99;
        }
        .nav-dropdown.open {
            max-height: 400px;
            opacity: 1;
            pointer-events: all;
        }
        .nav-dropdown li {
            border-bottom: 1px solid rgba(180,150,90,0.18);
        }
        .nav-dropdown li:last-child { border-bottom: none; }
        .nav-dropdown a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 18px 24px;
            text-decoration: none;
            color: #78350f;
            font-weight: 600;
            font-size: 1rem;
            font-family: 'Quicksand', sans-serif;
            transition: background 0.18s, color 0.18s;
            position: relative;
        }
        .nav-dropdown a:hover {
            background: rgba(146,100,64,0.07);
            color: var(--amber);
        }
        /* Active ‚Äî n·ªÅn ƒë·∫≠m, ch·ªØ tr·∫Øng, ƒë·∫≠m h∆°n */
        .nav-dropdown a.active {
            background: var(--amber);
            color: #fff;
            font-weight: 800;
            font-size: 1.05rem;
        }
        .nav-dropdown a.active:hover {
            background: #78350f;
            color: #fff;
        }

        /* ======= HEADER ======= */
        .page-header {
            text-align: center;
            padding: 3rem 1rem 1.5rem;
            position: relative;
            z-index: 1;
        }
        .page-header h1 {
            font-family: cursive;
            font-size: clamp(2.5rem, 6vw, 4.5rem);
            color: var(--amber);
            text-shadow: 2px 2px 0 rgba(146,100,64,0.15);
        }
        .page-header p {
            font-family: 'Caveat', cursive;
            font-size: 1.3rem;
            color: #a16207;
            margin-top: 0.5rem;
        }

        /* ======= CONNECTION STATUS ======= */
        #connectionStatus {
            max-width: 500px;
            margin: 0 auto 1.5rem;
            text-align: center;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        #connectionStatus.ok { background: #d1fae5; color: #065f46; border: 2px dashed #6ee7b7; }
        #connectionStatus.err { background: #fee2e2; color: #7f1d1d; border: 2px dashed #fca5a5; }
        #connectionStatus.loading { background: #fef3c7; color: #78350f; border: 2px dashed #fcd34d; }

        /* ======= MASONRY GRID ======= */
        .masonry-container {
            max-width: 1300px;
            margin: 0 auto;
            padding: 0 1rem 4rem;
            position: relative;
            z-index: 1;
        }
        .masonry-grid {
            columns: 4;
            column-gap: 1.5rem;
        }
        @media (max-width: 1100px) { .masonry-grid { columns: 3; } }
        @media (max-width: 750px)  { .masonry-grid { columns: 2; } }
        @media (max-width: 450px)  { .masonry-grid { columns: 1; } }

        /* ======= POLAROID CARDS ======= */
        .photo-card {
            break-inside: avoid;
            margin-bottom: 1.5rem;
            display: inline-block;
            width: 100%;
            cursor: pointer;
            position: relative;
        }
        .polaroid {
            background: #fff;
            padding: 10px 10px 48px;
            box-shadow: 3px 3px 12px rgba(0,0,0,0.15);
            position: relative;
            transition: transform 0.3s ease, box-shadow 0.3s ease, filter 0.3s ease;
            filter: saturate(0.85) sepia(0.1);
        }
        .polaroid:hover {
            transform: rotate(0deg) scale(1.04) !important;
            box-shadow: 8px 12px 30px rgba(0,0,0,0.25);
            filter: saturate(1.1) sepia(0);
            z-index: 10;
        }
        .polaroid img {
            width: 100%;
            display: block;
            object-fit: cover;
        }
        .polaroid video {
            width: 100%;
            display: block;
        }
        .polaroid-caption {
            font-family: 'Caveat', cursive;
            font-size: 1rem;
            color: #5c3a1e;
            text-align: center;
            position: absolute;
            bottom: 8px;
            left: 10px;
            right: 10px;
            line-height: 1.3;
        }

        /* Washi tapes */
        .tape {
            position: absolute;
            height: 22px;
            width: 70px;
            z-index: 5;
            opacity: 0.8;
        }
        .tape-tl { top: -10px; left: 10%; transform: rotate(-8deg); }
        .tape-tr { top: -10px; right: 10%; transform: rotate(5deg); }
        .tape-yellow { background: var(--tape-yellow); }
        .tape-clear  { background: rgba(200,220,255,0.55); border: 1px solid rgba(100,150,220,0.3); }
        .tape-plaid  { background: var(--tape-plaid); }

        /* Paper clip */
        .clip {
            position: absolute;
            top: -14px;
            right: 18px;
            font-size: 1.4rem;
            z-index: 6;
            transform: rotate(10deg);
            filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.3));
        }

        /* Like bar */
        .card-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            background: rgba(255,255,255,0.9);
            position: absolute;
            bottom: -1px;
            left: 0; right: 0;
            opacity: 0;
            transition: opacity 0.25s;
            border-top: 1px solid #f0e6d0;
        }
        .photo-card:hover .card-actions { opacity: 1; }
        .like-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 700;
            color: #b45309;
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 3px 8px;
            border-radius: 12px;
            transition: background 0.2s;
            font-family: 'Quicksand', sans-serif;
        }
        .like-btn:hover { background: #fee2e2; color: #e11d48; }
        .time-badge {
            margin-left: auto;
            font-size: 0.72rem;
            color: #a16207;
            font-family: 'Caveat', cursive;
        }

        /* ======= SCROLL REVEAL ======= */
        .photo-card {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .photo-card.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* ======= FLOATING UPLOAD BTN ======= */
        #floatUploadBtn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 90;
            background: #92400e;
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 64px;
            height: 64px;
            font-size: 1.8rem;
            box-shadow: 0 6px 24px rgba(146,64,14,0.45);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        #floatUploadBtn:hover {
            transform: scale(1.1) rotate(-5deg);
            box-shadow: 0 10px 32px rgba(146,64,14,0.55);
        }

        /* ======= UPLOAD MODAL (notebook paper) ======= */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 200;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .modal-overlay.open { display: flex; }
        .notebook-form {
            background: #fffef5;
            background-image:
                repeating-linear-gradient(transparent, transparent 27px, #c2e0f0 27px, #c2e0f0 28px),
                linear-gradient(90deg, #f7a0a0 30px, transparent 30px);
            border-radius: 4px;
            padding: 2rem 2rem 2rem 3.5rem;
            width: 100%;
            max-width: 520px;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-height: 90vh;
            overflow-y: auto;
            border-top: 4px solid #e0c45a;
        }
        .notebook-form h3 {
            font-family: 'Dancing Script', cursive;
            font-size: 1.8rem;
            color: var(--amber);
            margin-bottom: 1.2rem;
        }
        .form-group { margin-bottom: 1.2rem; }
        .form-group label {
            display: block;
            font-weight: 700;
            color: #92400e;
            margin-bottom: 6px;
            font-size: 0.9rem;
        }
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px 14px;
            border: 2px solid #d4a95a;
            border-radius: 8px;
            background: rgba(255,255,255,0.8);
            font-family: 'Quicksand', sans-serif;
            font-size: 0.95rem;
            color: #5c3a1e;
            outline: none;
            transition: border-color 0.2s;
        }
        .form-group input:focus,
        .form-group textarea:focus { border-color: var(--teal); }
        .tape-select { display: flex; gap: 10px; flex-wrap: wrap; }
        .tape-option {
            cursor: pointer;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        .tape-option.selected { border-color: #92400e; }
        .tape-opt-yellow { background: rgba(255,220,100,0.7); color: #78350f; }
        .tape-opt-clear  { background: rgba(200,220,255,0.7); color: #1e3a5f; }
        .tape-opt-plaid  { background: repeating-linear-gradient(45deg,#ffaaaa 0,#ffaaaa 4px,#fff 4px,#fff 8px); color: #7f1d1d; }
        #submitBtn {
            width: 100%;
            padding: 12px;
            background: #92400e;
            color: #fff;
            border: none;
            border-radius: 10px;
            font-size: 1.05rem;
            font-weight: 700;
            cursor: pointer;
            font-family: 'Quicksand', sans-serif;
            transition: background 0.2s, transform 0.15s;
            margin-top: 0.5rem;
        }
        #submitBtn:hover { background: #78350f; transform: translateY(-1px); }
        #submitBtn:disabled { background: #ccc; cursor: default; transform: none; }
        .close-modal {
            position: absolute;
            top: 12px; right: 14px;
            background: none;
            border: none;
            font-size: 1.4rem;
            cursor: pointer;
            color: #92400e;
        }

        /* ======= LIGHTBOX ======= */
        .lightbox {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.88);
            z-index: 300;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            flex-direction: column;
            gap: 1rem;
        }
        .lightbox.open { display: flex; }
        .lightbox img, .lightbox video {
            max-width: 90vw;
            max-height: 75vh;
            object-fit: contain;
            border: 6px solid #fff;
            box-shadow: 0 10px 60px rgba(0,0,0,0.7);
        }
        .lightbox-caption {
            font-family: 'Dancing Script', cursive;
            font-size: 1.5rem;
            color: #fef3c7;
            text-align: center;
            max-width: 600px;
        }
        .lightbox-close {
            position: fixed;
            top: 1.5rem; right: 2rem;
            font-size: 2.5rem;
            color: #fff;
            cursor: pointer;
            background: none;
            border: none;
            line-height: 1;
            z-index: 301;
        }

        /* ======= VINYL PLAYER ======= */
        #vinylPlayer {
            position: fixed;
            bottom: 2rem;
            left: 2rem;
            z-index: 90;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }
        #vinylDisc {
            width: 54px;
            height: 54px;
            border-radius: 50%;
            background: radial-gradient(circle at 50%, #333 0%, #111 35%, #555 36%, #111 37%, #333 100%);
            box-shadow: 0 4px 16px rgba(0,0,0,0.4);
            cursor: pointer;
            transition: transform 0.3s;
            position: relative;
            border: 3px solid #888;
        }
        #vinylDisc::after {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%,-50%);
            width: 12px; height: 12px;
            border-radius: 50%;
            background: #ccc;
        }
        #vinylDisc.spinning {
            animation: spin 2s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        #vinylLabel {
            font-family: 'Caveat', cursive;
            font-size: 0.75rem;
            color: #78350f;
            text-align: center;
        }

        /* ======= EMPTY STATE ======= */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            font-family: 'Dancing Script', cursive;
            font-size: 1.6rem;
            color: #a16207;
        }

        /* ======= FOOTER ======= */
        footer {
            background: rgba(255,255,255,0.7);
            border-top: 2px dashed #d4a95a;
            text-align: center;
            padding: 2rem;
            font-family: 'Dancing Script', cursive;
            color: #92400e;
            font-size: 1.2rem;
            position: relative;
            z-index: 1;
        }

        /* Drop zone */
        #fileDropZone {
            display: block;
            border: 2px dashed #d4a95a;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            background: rgba(255,255,255,0.6);
            transition: background 0.2s, border-color 0.2s;
            color: #78350f;
            font-size: 0.9rem;
            font-weight: 600;
        }
        #fileDropZone:hover { background: rgba(255,240,200,0.7); border-color: #92400e; }
        #fileDropZone input[type=file] { display: none; }

        /* Multi preview grid */
        #previewContainer {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }
        .preview-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            background: #f0ece0;
            aspect-ratio: 1;
        }
        .preview-item img, .preview-item video {
            width: 100%; height: 100%;
            object-fit: cover;
            display: block;
        }
        .preview-item .remove-btn {
            position: absolute;
            top: 3px; right: 3px;
            background: rgba(0,0,0,0.6);
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 20px; height: 20px;
            font-size: 0.7rem;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            line-height: 1;
        }
        .preview-item .vid-badge {
            position: absolute;
            bottom: 3px; left: 3px;
            background: rgba(0,0,0,0.55);
            color: #fff;
            font-size: 0.65rem;
            padding: 1px 5px;
            border-radius: 6px;
        }
        #fileCount {
            font-size: 0.82rem;
            color: #a16207;
            margin-top: 6px;
            font-weight: 600;
        }
    </style>
</head>
<body>

<!-- NAVBAR -->
<nav>
    <div class="nav-inner">
        <a href="index.html" class="nav-logo">12A15</a>

        <!-- Hamburger button -->
        <button class="hamburger" id="hamburgerBtn" onclick="toggleMenu()" aria-label="Menu">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
        </button>

        <!-- Dropdown -->
        <ul class="nav-dropdown" id="navDropdown">
            <li><a href="index.html"><span>üè†</span> Trang ch·ªß</a></li>
            <li><a href="thanhvienlop.html"><span>üë•</span> Th√†nh vi√™n l·ªõp</a></li>
            <li><a href="kiniem1.html" class="active"><span>üì∑</span> K·ª∑ ni·ªám</a></li>
        </ul>
    </div>
</nav>

<!-- HEADER -->
<div class="page-header">
    <h1>‚ú® N∆°i L∆∞u Gi·ªØ K·ª∑ Ni·ªám ‚ú®</h1>
    <p>üìñ Cu·ªën s·ªï l∆∞u b√∫t c·ªßa 12A15 ‚Ä¢ NƒÉm h·ªçc 2023‚Äì2026 üå∏</p>
</div>

<!-- CONNECTION STATUS -->
<div id="connectionStatus" class="loading">‚ö° ƒêang k·∫øt n·ªëi...</div>

<!-- MASONRY GRID -->
<div class="masonry-container">
    <div id="postsFeed" class="masonry-grid">
        <div class="empty-state" style="column-span:all;">
            üì∑<br>ƒêang t·∫£i nh·ªØng k·ª∑ ni·ªám...
        </div>
    </div>
</div>

<!-- FLOATING UPLOAD BTN -->
<button id="floatUploadBtn" onclick="openUploadModal()" title="Ghim th√™m k·ª∑ ni·ªám">üìå</button>

<!-- VINYL PLAYER -->
<div id="vinylPlayer">
    <div id="vinylDisc" onclick="toggleMusic()" title="B·∫≠t/t·∫Øt nh·∫°c lofi"></div>
    <div id="vinylLabel">üéµ Lofi</div>
</div>
<audio id="bgMusic" loop>
    <source src="Rather Be (feat. Jess Glynne).mp3" type="audio/mpeg">
</audio>

<!-- UPLOAD MODAL -->
<div class="modal-overlay" id="uploadModal">
    <div class="notebook-form">
        <button class="close-modal" onclick="closeUploadModal()">‚úñ</button>
        <h3>üìå Ghim K·ª∑ Ni·ªám M·ªõi</h3>

        <div class="form-group">
            <label>üì∑üé• Ch·ªçn ·∫£nh / video (nhi·ªÅu file)</label>
            <label id="fileDropZone">
                <input type="file" id="fileInput" accept="image/*,video/*" multiple onchange="previewFiles()">
                <div id="dropZoneLabel">
                    <span style="font-size:2rem;">üìÇ</span><br>
                    B·∫•m ho·∫∑c k√©o th·∫£ file v√†o ƒë√¢y<br>
                    <small style="color:#a16207;">H·ªó tr·ª£ ch·ªçn nhi·ªÅu ·∫£nh/video c√πng l√∫c</small>
                </div>
            </label>
            <div id="previewContainer"></div>
            <div id="fileCount"></div>
        </div>

        <div class="form-group">
            <label>‚úçÔ∏è C√¢u chuy·ªán / Caption</label>
            <textarea id="captionInput" rows="3" placeholder="K·ª∑ ni·ªám n√†o ƒë√¢y... ‚ú®"></textarea>
        </div>

        <div class="form-group">
            <label>üßª Ch·ªçn bƒÉng keo d√°n ·∫£nh</label>
            <div class="tape-select" id="tapeSelect">
                <div class="tape-option tape-opt-yellow selected" data-tape="yellow" onclick="selectTape(this)">üü® V√†ng</div>
                <div class="tape-option tape-opt-clear" data-tape="clear" onclick="selectTape(this)">üî≤ Trong</div>
                <div class="tape-option tape-opt-plaid" data-tape="plaid" onclick="selectTape(this)">üî¥ Caro</div>
            </div>
        </div>

        <div class="form-group">
            <label>üë§ Ng∆∞·ªùi g·ª≠i (t√πy ch·ªçn)</label>
            <input type="text" id="authorInput" placeholder="T√™n c·ªßa b·∫°n...">
        </div>

        <div class="form-group">
            <label>üîí M·∫≠t kh·∫©u l·ªõp</label>
            <input type="password" id="passwordInput" placeholder="Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ ghim...">
        </div>

        <button id="submitBtn" onclick="submitPost()">üöÄ Ghim k·ª∑ ni·ªám n√†y!</button>
    </div>
</div>

<!-- LIGHTBOX -->
<div class="lightbox" id="lightbox" onclick="closeLightbox()">
    <button class="lightbox-close" onclick="closeLightbox()">‚úï</button>
    <img id="lightboxImg" src="" style="display:none">
    <video id="lightboxVid" controls style="display:none"></video>
    <div class="lightbox-caption" id="lightboxCaption"></div>
</div>

<!-- FOOTER -->
<footer>
    ‚ú® 12A15 Memories ‚ú®<br>
    <span style="font-size:1rem; font-family:'Quicksand',sans-serif; color:#a16207;">N∆°i l∆∞u gi·ªØ nh·ªØng kho·∫£nh kh·∫Øc ƒë·∫πp nh·∫•t üíñ</span>
</footer>

<script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getDatabase, ref, push, onValue, update, get } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

    const firebaseConfig = {
        apiKey: "AIzaSyAngaevXBKT3yFFxFlcLysmtW1rW9X3HGs",
        authDomain: "class12a15-a430c.firebaseapp.com",
        databaseURL: "https://class12a15-a430c-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "class12a15-a430c",
        storageBucket: "class12a15-a430c.firebasestorage.app",
        messagingSenderId: "151998818188",
        appId: "1:151998818188:web:35a03f34296fd4d70f18a9"
    };

    const CLASS_PASSWORD = '12a15maidinh';
    let database;
    let currentFile = null, currentFileType = null;
    const tilts = [-4, -2.5, -1.5, 0.5, 1.5, 2.5, 3.5, -3, 1, -0.8, 2, -1.2];
    const tapeTypes = ['yellow','clear','plaid'];
    const clipPositions = [false, false, true, false, true, false]; // every 3rd gets a clip

    try {
        const app = initializeApp(firebaseConfig);
        database = getDatabase(app);
        setStatus(true);
    } catch(e) {
        setStatus(false);
    }

    function setStatus(ok) {
        const s = document.getElementById('connectionStatus');
        s.className = ok ? 'ok' : 'err';
        s.textContent = ok ? '‚úÖ ƒê√£ k·∫øt n·ªëi! M·ªçi ng∆∞·ªùi c√≥ th·ªÉ th·∫•y k·ª∑ ni·ªám c·ªßa b·∫°n' : '‚ùå L·ªói k·∫øt n·ªëi Firebase';
    }

    function formatDate(ts) {
        const diff = Date.now() - ts;
        const m = Math.floor(diff/60000), h = Math.floor(diff/3600000), d = Math.floor(diff/86400000);
        if (m<1) return 'V·ª´a xong';
        if (m<60) return `${m} ph√∫t tr∆∞·ªõc`;
        if (h<24) return `${h} gi·ªù tr∆∞·ªõc`;
        if (d<7) return `${d} ng√†y tr∆∞·ªõc`;
        return new Date(ts).toLocaleDateString('vi-VN');
    }

    function tapeStyle(type) {
        if (type === 'yellow') return 'background:rgba(255,220,100,0.72);';
        if (type === 'clear')  return 'background:rgba(200,230,255,0.55);border:1px solid rgba(100,150,220,0.4);';
        return 'background:repeating-linear-gradient(45deg,rgba(255,100,100,0.35) 0px,rgba(255,100,100,0.35) 4px,rgba(255,255,255,0.35) 4px,rgba(255,255,255,0.35) 8px);';
    }

    function buildCard(post, i) {
        const tilt = tilts[i % tilts.length];
        const tape = post.tape || tapeTypes[i % 3];
        const hasClip = clipPositions[i % clipPositions.length];
        const mediaEl = post.mediaType === 'video'
            ? `<video src="${post.media}" preload="metadata" style="max-height:260px;width:100%;object-fit:cover;display:block;"></video>`
            : `<img src="${post.media}" alt="${post.caption}" style="display:block;width:100%;" loading="lazy">`;
        const clipHTML = hasClip ? `<div class="clip">üìé</div>` : '';
        const author = post.author ? `<span style="font-size:0.75rem;color:#a16207;">(${post.author})</span>` : '';

        return `
        <div class="photo-card" data-id="${post.firebaseId}" onclick="openLightbox('${post.firebaseId}')">
            <div class="polaroid" style="transform: rotate(${tilt}deg);">
                <div class="tape tape-tl" style="${tapeStyle(tape)}"></div>
                <div class="tape tape-tr" style="${tapeStyle(tape)}"></div>
                ${clipHTML}
                ${mediaEl}
                <div class="polaroid-caption">${post.caption} ${author}</div>
                <div class="card-actions" onclick="event.stopPropagation()">
                    <button class="like-btn" onclick="likePost('${post.firebaseId}')">
                        ${(post.likes||0)>0?'‚ù§Ô∏è':'ü§ç'} ${post.likes||0}
                    </button>
                    <span class="time-badge">üïí ${formatDate(post.timestamp)}</span>
                </div>
            </div>
        </div>`;
    }

    function displayPosts(posts) {
        const feed = document.getElementById('postsFeed');
        if (!posts.length) {
            feed.innerHTML = `<div class="empty-state" style="column-span:all;">üì∏<br>Ch∆∞a c√≥ k·ª∑ ni·ªám n√†o. H√£y ghim k·ª∑ ni·ªám ƒë·∫ßu ti√™n! üåü</div>`;
            return;
        }
        feed.innerHTML = posts.map((p,i) => buildCard(p,i)).join('');
        // Scroll reveal
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(e => { if (e.isIntersecting) { e.target.classList.add('visible'); observer.unobserve(e.target); } });
        }, { threshold: 0.1 });
        feed.querySelectorAll('.photo-card').forEach((el, i) => {
            setTimeout(() => observer.observe(el), i * 60);
        });
    }

    function loadPosts() {
        if (!database) { displayPosts([]); return; }
        const postsRef = ref(database, 'posts');
        onValue(postsRef, snap => {
            const data = snap.val();
            const posts = data ? Object.keys(data).map(k=>({...data[k], firebaseId:k})).sort((a,b)=>b.timestamp-a.timestamp) : [];
            displayPosts(posts);
        });
    }

    // Expose globals
    window._db = () => database;
    window._ref = ref;
    window._get = get;
    window._update = update;
    window._push = push;
    window._CLASS_PASSWORD = CLASS_PASSWORD;
    window._formatDate = formatDate;

    window.submitPost = async function() {
        if (!database) { alert('‚ùå Ch∆∞a k·∫øt n·ªëi Firebase!'); return; }
        const caption = document.getElementById('captionInput').value.trim();
        const password = document.getElementById('passwordInput').value;
        const author = document.getElementById('authorInput').value.trim();
        const tape = document.querySelector('.tape-option.selected')?.dataset.tape || 'yellow';
        const btn = document.getElementById('submitBtn');
        if (!currentFile || !caption) { alert('Vui l√≤ng ch·ªçn ·∫£nh/video v√† nh·∫≠p caption!'); return; }
        if (password !== CLASS_PASSWORD) { alert('‚ùå M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!'); return; }
        btn.disabled = true; btn.textContent = '‚è≥ ƒêang ghim...';
        try {
            await push(ref(database,'posts'), { media: currentFile, mediaType: currentFileType, caption, author, tape, timestamp: Date.now(), likes: 0 });
            closeUploadModal();
            playCamera();
            alert('‚úÖ ƒê√£ ghim k·ª∑ ni·ªám!');
        } catch(e) { alert('‚ùå C√≥ l·ªói x·∫£y ra. Th·ª≠ l·∫°i nh√©!'); }
        finally { btn.disabled=false; btn.textContent='üöÄ Ghim k·ª∑ ni·ªám n√†y!'; }
    };

    window.likePost = async function(id) {
        if (!database) return;
        try {
            const snap = await get(ref(database,`posts/${id}`));
            const cur = snap.val()?.likes||0;
            const upd = {}; upd[`posts/${id}/likes`] = cur+1;
            await update(ref(database), upd);
        } catch(e) {}
    };

    // Lightbox
    let allPosts = [];
    window.openLightbox = function(id) {
        onValue(ref(database,`posts/${id}`), snap => {
            const p = snap.val(); if(!p) return;
            const lb = document.getElementById('lightbox');
            const img = document.getElementById('lightboxImg');
            const vid = document.getElementById('lightboxVid');
            const cap = document.getElementById('lightboxCaption');
            playCamera();
            if (p.mediaType==='video') {
                vid.src=p.media; vid.style.display='block'; img.style.display='none';
            } else {
                img.src=p.media; img.style.display='block'; vid.style.display='none'; vid.pause && vid.pause();
            }
            cap.textContent = `${p.caption}${p.author?' ‚Äî '+p.author:''}  ‚Ä¢  ${formatDate(p.timestamp)}`;
            lb.classList.add('open');
        }, {onlyOnce:true});
    };

    loadPosts();
</script>

<script>
    // Non-module globals
    window.openUploadModal = function() {
        document.getElementById('uploadModal').classList.add('open');
    };
    window.closeUploadModal = function() {
        document.getElementById('uploadModal').classList.remove('open');
        document.getElementById('fileInput').value = '';
        document.getElementById('captionInput').value = '';
        document.getElementById('passwordInput').value = '';
        document.getElementById('authorInput').value = '';
        document.getElementById('previewContainer').innerHTML = '';
        document.getElementById('fileCount').textContent = '';
        window._multiFiles = [];
    };
    window.closeLightbox = function() {
        const lb = document.getElementById('lightbox');
        lb.classList.remove('open');
        const vid = document.getElementById('lightboxVid');
        if (vid) { vid.pause(); vid.src=''; }
    };
    window.selectTape = function(el) {
        document.querySelectorAll('.tape-option').forEach(e=>e.classList.remove('selected'));
        el.classList.add('selected');
    };
    // Multi-file store
    window._multiFiles = []; // [{b64, type, name}]

    window.previewFiles = function() {
        const input = document.getElementById('fileInput');
        const files = Array.from(input.files);
        const container = document.getElementById('previewContainer');
        const countEl = document.getElementById('fileCount');
        const valid = files;
        if (!valid.length) return;

        // Read all files
        let loaded = 0;
        window._multiFiles = [];
        container.innerHTML = '';

        valid.forEach((file, idx) => {
            const reader = new FileReader();
            reader.onload = e => {
                const type = file.type.startsWith('video/') ? 'video' : 'image';
                window._multiFiles[idx] = { b64: e.target.result, type, name: file.name };
                loaded++;

                // Build preview item
                const item = document.createElement('div');
                item.className = 'preview-item';
                item.dataset.idx = idx;
                if (type === 'video') {
                    const v = document.createElement('video');
                    v.src = e.target.result; v.preload = 'metadata';
                    item.appendChild(v);
                    const badge = document.createElement('div');
                    badge.className = 'vid-badge'; badge.textContent = 'üé•';
                    item.appendChild(badge);
                } else {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    item.appendChild(img);
                }
                const rmBtn = document.createElement('button');
                rmBtn.className = 'remove-btn';
                rmBtn.textContent = '‚úï';
                rmBtn.onclick = () => {
                    window._multiFiles[idx] = null;
                    item.remove();
                    updateCount();
                };
                item.appendChild(rmBtn);
                container.appendChild(item);

                if (loaded === valid.length) updateCount();
            };
            reader.readAsDataURL(file);
        });

        function updateCount() {
            const n = (window._multiFiles || []).filter(Boolean).length;
            countEl.textContent = n > 0 ? `‚úÖ ƒê√£ ch·ªçn ${n} file` : '';
        }
    };

    // Vinyl / music
    let musicPlaying = false;
    window.toggleMusic = function() {
        const audio = document.getElementById('bgMusic');
        const disc = document.getElementById('vinylDisc');
        const label = document.getElementById('vinylLabel');
        if (musicPlaying) {
            audio.pause();
            disc.classList.remove('spinning');
            label.textContent = 'üéµ Lofi';
        } else {
            audio.play().catch(()=>{});
            disc.classList.add('spinning');
            label.textContent = '‚è∏ ƒêang ph√°t';
        }
        musicPlaying = !musicPlaying;
    };

    // Camera sound
    window.playCamera = function() {
        try {
            const ctx = new (window.AudioContext||window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain); gain.connect(ctx.destination);
            osc.frequency.setValueAtTime(1200, ctx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(800, ctx.currentTime+0.06);
            gain.gain.setValueAtTime(0.3, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime+0.12);
            osc.start(); osc.stop(ctx.currentTime+0.12);
        } catch(e) {}
    };

    // Close lightbox on ESC
    document.addEventListener('keydown', e => { if(e.key==='Escape') { window.closeLightbox && closeLightbox(); closeMenu(); } });

    // Hamburger menu
    window.toggleMenu = function() {
        const btn = document.getElementById('hamburgerBtn');
        const dd  = document.getElementById('navDropdown');
        const open = dd.classList.toggle('open');
        btn.classList.toggle('open', open);
    };
    window.closeMenu = function() {
        document.getElementById('hamburgerBtn').classList.remove('open');
        document.getElementById('navDropdown').classList.remove('open');
    };
    // Close when clicking outside
    document.addEventListener('click', e => {
        const nav = document.querySelector('nav');
        if (nav && !nav.contains(e.target)) closeMenu();
    });
</script>

<!-- Multi-file submit ‚Äî base64 -->
<script type="module">
    window.submitPost = async function() {
        const db = window._db && window._db();
        if (!db) { alert('‚ùå Ch∆∞a k·∫øt n·ªëi Firebase!'); return; }

        const files = (window._multiFiles || []).filter(Boolean);
        const caption = document.getElementById('captionInput').value.trim();
        const password = document.getElementById('passwordInput').value;
        const author = document.getElementById('authorInput').value.trim();
        const tape = document.querySelector('.tape-option.selected')?.dataset.tape || 'yellow';
        const btn = document.getElementById('submitBtn');

        if (!files.length) { alert('Vui l√≤ng ch·ªçn √≠t nh·∫•t 1 ·∫£nh/video!'); return; }
        if (!caption)       { alert('Vui l√≤ng nh·∫≠p caption!'); return; }
        if (password !== window._CLASS_PASSWORD) { alert('‚ùå M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!'); return; }

        btn.disabled = true;
        let ok = 0, fail = 0;

        for (let i = 0; i < files.length; i++) {
            const f = files[i];
            btn.textContent = `‚è≥ ƒêang ghim ${i+1}/${files.length}...`;
            try {
                await window._push(window._ref(db, 'posts'), {
                    media: f.b64,
                    mediaType: f.type,
                    caption,
                    author,
                    tape,
                    timestamp: Date.now() + i,
                    likes: 0
                });
                ok++;
            } catch(e) { console.error(e); fail++; }
        }

        btn.disabled = false;
        btn.textContent = 'üöÄ Ghim k·ª∑ ni·ªám n√†y!';
        window.closeUploadModal();
        window.playCamera && window.playCamera();

        if (fail === 0) {
            alert(`‚úÖ ƒê√£ ghim ${ok} k·ª∑ ni·ªám th√†nh c√¥ng!`);
        } else {
            alert(`‚úÖ Th√†nh c√¥ng ${ok} file, ‚ùå th·∫•t b·∫°i ${fail} file.`);
        }
    };
</script>

</body>
</html>
